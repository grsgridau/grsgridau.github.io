<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Power Plant Ramp Rate Optimizer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <style>
    :root{
      --bg: linear-gradient(135deg, #772835 0%, #666666 100%);
      --card:#ffffff;
      --text:#666666;
      --muted:#999999;
      --accent:#772835;
      --accent-dark:#5a1e28;
      --border:#e1e1e1;
      --success:#772835;
      --warning:#772835;
      --danger:#772835;
      --shadow: 0 10px 30px rgba(119,40,53,0.15);
      --radius: 12px;
    }
    
    /* Global layout safety: prevent bleed and enable scrollbars */
    html, body {
      width: 100%;
      height: 100%;
      max-width: 100%;
      overflow-x: hidden;   /* no horizontal bleed */
      overflow-y: auto;     /* allow vertical scrolling */
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background:var(--bg);
      color:var(--text);
      line-height:1.6;
      min-height: 100vh;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 15px;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    header{
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(10px);
      color: var(--text);
      padding: 15px 20px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-bottom: 15px;
      flex-shrink: 0;
    }
    header h1{
      margin:0;
      font-size:1.8rem;
      font-weight: 700;
      background: linear-gradient(135deg, #772835, #666666);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    header p{
      margin:5px 0 0 0;
      opacity:.8;
      font-size: 0.9rem;
    }
    
    main{
      display:grid;
      gap:15px;
      grid-template-columns: 320px 1fr;
      flex: 1;
      min-height: 0;
    }
    @media (max-width: 1200px){
      main{grid-template-columns:1fr}
    }
    
    .card{
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(10px);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:20px;
      box-shadow:var(--shadow);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      min-height: 0;
      display: flex;
      flex-direction: column;
    }
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 15px 40px rgba(0,0,0,0.2);
    }
    
    .card h2{
      margin:0 0 15px 0;
      font-size:1.3rem;
      font-weight: 600;
      color: var(--text);
      flex-shrink: 0;
    }
    
    .field{
      margin:15px 0;
    }
    .field label{
      font-size:13px;
      font-weight: 600;
      color:var(--text);
      display:block;
      margin-bottom:6px;
    }
    
    .slider-container {
      position: relative;
      margin: 10px 0;
    }
    
    .slider {
      width: 100%;
      height: 8px;
      border-radius: 4px;
      background: linear-gradient(to right, #e1e8ed 0%, var(--accent) 100%);
      outline: none;
      -webkit-appearance: none;
      appearance: none;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: var(--accent);
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      transition: all 0.2s ease;
    }
    
    .slider::-webkit-slider-thumb:hover {
      background: var(--accent-dark);
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    
    .slider::-moz-range-thumb {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: var(--accent);
      cursor: pointer;
      border: none;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    
    .slider-value {
      position: absolute;
      right: 0;
      top: -30px;
      background: var(--accent);
      color: white;
      padding: 4px 12px;
      border-radius: 15px;
      font-size: 12px;
      font-weight: 600;
      min-width: 60px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .slider-value:hover {
      background: var(--accent-dark);
      transform: scale(1.05);
    }
    
    .slider-value-input {
      position: absolute;
      right: 0;
      top: -30px;
      background: var(--accent);
      color: white;
      padding: 4px 12px;
      border-radius: 15px;
      font-size: 12px;
      font-weight: 600;
      min-width: 60px;
      width: 80px;
      text-align: center;
      border: none;
      outline: none;
      cursor: text;
    }
    
    .slider-value-input:focus {
      background: var(--accent-dark);
      box-shadow: 0 0 0 2px rgba(255,255,255,0.3);
    }
    
    .input-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin: 20px 0;
    }
    
    .input-field {
      padding: 12px 15px;
      border: 2px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
      background: white;
      color: var(--text);
      transition: border-color 0.2s ease;
    }
    
    .input-field:focus {
      outline: none;
      border-color: var(--accent);
    }
    
    .stats-grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap:10px;
      margin: 15px 0;
    }
    
    .stat{
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border:1px solid var(--border);
      border-radius:8px;
      padding:12px;
      text-align: center;
      transition: transform 0.2s ease;
    }
    .stat:hover {
      transform: translateY(-2px);
    }
    
    .stat .label{
      font-size:11px;
      color:var(--muted);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .stat .value{
      font-size:1.3rem;
      margin-top:4px;
      font-weight:700;
      color: var(--text);
    }
    .stat .unit {
      font-size: 0.8rem;
      color: var(--muted);
      font-weight: 400;
    }
    
    .chart-container {
      background: white;
      border-radius: var(--radius);
      padding: 15px;
      box-shadow: var(--shadow);
      margin: 15px 0;
      flex: 1;
      min-height: 0;
      display: flex;
      flex-direction: column;
    }
    
    canvas{
      display:block;
      width:100% !important;
      height:auto !important;
      max-width:100%;
      flex: 1;
      min-height: 250px;
    }
    
    .btn{
      appearance:none;
      border:none;
      background: linear-gradient(135deg, var(--accent), var(--accent-dark));
      color:#fff;
      padding:12px 24px;
      border-radius:8px;
      font-weight:600;
      cursor:pointer;
      box-shadow: 0 4px 12px rgba(119, 40, 53, 0.3);
      transition: all 0.2s ease;
      font-size: 14px;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(119, 40, 53, 0.4);
    }
    
    .btn.secondary{
      background: linear-gradient(135deg, #666666, #555555);
      box-shadow: 0 4px 12px rgba(102, 102, 102, 0.3);
    }
    .btn.secondary:hover {
      box-shadow: 0 6px 16px rgba(102, 102, 102, 0.4);
    }
    
    .warning-badge {
      background: #772835;
      color: white;
      padding: 6px 12px;
      border-radius: 15px;
      font-size: 12px;
      font-weight: 600;
      display: inline-block;
      margin: 10px 0;
    }
    
    .success-badge {
      background: #772835;
      color: white;
      padding: 6px 12px;
      border-radius: 15px;
      font-size: 12px;
      font-weight: 600;
      display: inline-block;
      margin: 10px 0;
    }
    
    .note{
      font-size:12px;
      color:var(--muted);
      margin-top:10px;
      padding: 10px;
      background: rgba(119, 40, 53, 0.1);
      border-radius: 6px;
      border-left: 4px solid var(--accent);
    }
    
    @media (max-width: 768px) {
      .container { padding: 10px; }
      header h1 { font-size: 1.5rem; }
      .input-group { grid-template-columns: 1fr; }
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
      main { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Power Plant Ramp Rate Optimizer</h1>
      <p>Design and optimize ramp rates for active (P) and reactive (Q) power transitions. Visualize plant performance from 100% to 0% output.</p>
    </header>

    <main>
      <section class="card" id="inputsCard">
        <h2>Plant Configuration</h2>
        
        <div class="field">
          <label>Plant Size (MW)</label>
          <div class="slider-container">
            <input type="range" id="plantSize" class="slider" min="1" max="1000" value="100" step="1">
            <input type="text" id="plantSizeValue" class="slider-value-input" value="100 MW">
          </div>
        </div>

        <div class="field">
          <label>Power Factor</label>
          <div class="slider-container">
            <input type="range" id="powerFactor" class="slider" min="0.7" max="1.0" value="0.95" step="0.01">
            <input type="text" id="powerFactorValue" class="slider-value-input" value="0.95">
          </div>
        </div>

        <div class="field">
          <label>Control Mode</label>
          <div class="input-group">
            <label style="display: flex; align-items: center; gap: 8px;">
              <input type="radio" name="controlMode" value="rate" checked>
              <span>Set Ramp Rate (%/sec)</span>
            </label>
            <label style="display: flex; align-items: center; gap: 8px;">
              <input type="radio" name="controlMode" value="time">
              <span>Set Ramp Time (seconds)</span>
            </label>
          </div>
        </div>

        <div id="rateControls">
          <div class="field">
            <label>Active Power Ramp Rate (%/sec)</label>
            <div class="slider-container">
              <input type="range" id="pRampRate" class="slider" min="0.1" max="20" value="5" step="0.01">
              <input type="text" id="pRampRateValue" class="slider-value-input" value="5.00 %/s">
            </div>
          </div>

          <div class="field">
            <label>Reactive Power Ramp Rate (%/sec)</label>
            <div class="slider-container">
              <input type="range" id="qRampRate" class="slider" min="0.1" max="20" value="3" step="0.01">
              <input type="text" id="qRampRateValue" class="slider-value-input" value="3.00 %/s">
            </div>
          </div>
        </div>

        <div id="timeControls" style="display: none;">
          <div class="field">
            <label>Active Power Ramp Time (seconds)</label>
            <div class="slider-container">
              <input type="range" id="pRampTime" class="slider" min="5" max="300" value="20" step="1">
              <input type="text" id="pRampTimeValue" class="slider-value-input" value="20 sec">
            </div>
          </div>

          <div class="field">
            <label>Reactive Power Ramp Time (seconds)</label>
            <div class="slider-container">
              <input type="range" id="qRampTime" class="slider" min="5" max="300" value="33" step="1">
              <input type="text" id="qRampTimeValue" class="slider-value-input" value="33 sec">
            </div>
          </div>
        </div>

        <div class="field">
          <label>Ramp Direction</label>
          <div class="input-group">
            <label style="display: flex; align-items: center; gap: 8px;">
              <input type="radio" name="direction" value="down" checked>
              <span>Ramp Down (100% → 0%)</span>
            </label>
            <label style="display: flex; align-items: center; gap: 8px;">
              <input type="radio" name="direction" value="up">
              <span>Ramp Up (0% → 100%)</span>
            </label>
          </div>
        </div>

        <div style="display:flex;gap:10px;margin-top:15px">
          <button class="btn" id="updateBtn">Update Ramp Profile</button>
          <button class="btn secondary" id="resetBtn">Reset to Defaults</button>
        </div>

        <div class="note">
          <strong>Tip:</strong> Faster ramp rates provide quicker response but may stress equipment. 
          Slower rates are gentler but take longer to complete transitions.
        </div>
      </section>

      <section class="card" id="resultsCard">
        <h2>Ramp Analysis</h2>
        
        <div class="stats-grid">
          <div class="stat">
            <div class="label">P Ramp Rate</div>
            <div class="value" id="pRampRateDisplay">5.00</div>
            <div class="unit">%/s</div>
          </div>
          <div class="stat">
            <div class="label">Q Ramp Rate</div>
            <div class="value" id="qRampRateDisplay">3.00</div>
            <div class="unit">%/s</div>
          </div>
          <div class="stat">
            <div class="label">P Ramp Time</div>
            <div class="value" id="pRampTimeDisplay">20</div>
            <div class="unit">seconds</div>
          </div>
          <div class="stat">
            <div class="label">Q Ramp Time</div>
            <div class="value" id="qRampTimeDisplay">33</div>
            <div class="unit">seconds</div>
          </div>
        </div>

        <div id="rampStatus"></div>

        <div class="chart-container">
          <canvas id="rampChart" height="200"></canvas>
        </div>

        <div class="stats-grid">
          <div class="stat">
            <div class="label">Active Power</div>
            <div class="value" id="activePowerValue">100</div>
            <div class="unit">MW</div>
          </div>
          <div class="stat">
            <div class="label">Reactive Power</div>
            <div class="value" id="reactivePowerValue">33</div>
            <div class="unit">Mvar</div>
          </div>
          <div class="stat">
            <div class="label">Apparent Power</div>
            <div class="value" id="apparentPowerValue">105</div>
            <div class="unit">MVA</div>
          </div>
          <div class="stat">
            <div class="label">Total Ramp Time</div>
            <div class="value" id="totalTimeValue">33</div>
            <div class="unit">seconds</div>
          </div>
          <div class="stat">
            <div class="label">P/Q Ratio</div>
            <div class="value" id="pqRatioValue">1.67</div>
            <div class="unit">—</div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script>
    // State management
    let state = {
      plantSize: 100,
      powerFactor: 0.95,
      pRampRate: 5.00,
      qRampRate: 3.00,
      pRampTime: 20,
      qRampTime: 33,
      direction: 'down',
      controlMode: 'rate'
    };

    let rampChart = null;

    // Utility functions
    const formatNumber = (value, decimals = 2) => {
      return Number(value).toFixed(decimals);
    };

    const clamp = (value, min, max) => {
      return Math.max(min, Math.min(max, value));
    };

    const calculateReactivePower = (activePower, powerFactor) => {
      const reactiveComponent = Math.sqrt(1 - powerFactor * powerFactor);
      return activePower * reactiveComponent / powerFactor;
    };

    const calculateApparentPower = (activePower, reactivePower) => {
      return Math.sqrt(activePower * activePower + reactivePower * reactivePower);
    };

    // Update slider values display
    function updateSliderValues() {
      document.getElementById('plantSizeValue').value = `${state.plantSize} MW`;
      document.getElementById('powerFactorValue').value = formatNumber(state.powerFactor, 2);
      
      if (state.controlMode === 'rate') {
        document.getElementById('pRampRateValue').value = `${formatNumber(state.pRampRate, 2)} %/s`;
        document.getElementById('qRampRateValue').value = `${formatNumber(state.qRampRate, 2)} %/s`;
      } else {
        document.getElementById('pRampTimeValue').value = `${formatNumber(state.pRampTime, 0)} sec`;
        document.getElementById('qRampTimeValue').value = `${formatNumber(state.qRampTime, 0)} sec`;
        
        // Calculate and update the rate displays (for informational purposes)
        const calculatedPRate = 100 / state.pRampTime;
        const calculatedQRate = 100 / state.qRampTime;
        state.pRampRate = calculatedPRate;
        state.qRampRate = calculatedQRate;
      }
    }

    // Parse value from editable slider value input
    function parseRampRateValue(inputValue) {
      // Extract number from "5.00 %/s" format
      const match = inputValue.match(/^([0-9]*\.?[0-9]+)/);
      return match ? parseFloat(match[1]) : null;
    }

    // Parse time value from editable input
    function parseTimeValue(inputValue) {
      // Extract number from "20 sec" format
      const match = inputValue.match(/^([0-9]*\.?[0-9]+)/);
      return match ? parseFloat(match[1]) : null;
    }

    // Parse plant size value from editable input
    function parsePlantSizeValue(inputValue) {
      // Extract number from "100 MW" format
      const match = inputValue.match(/^([0-9]*\.?[0-9]+)/);
      return match ? parseFloat(match[1]) : null;
    }

    // Parse power factor value from editable input
    function parsePowerFactorValue(inputValue) {
      // Extract number from "0.95" format
      const match = inputValue.match(/^([0-9]*\.?[0-9]+)/);
      return match ? parseFloat(match[1]) : null;
    }

    // Update state from editable value input
    function updateFromValueInput(element, isP = true) {
      if (state.controlMode === 'rate') {
        const rawValue = element.value;
        const numericValue = parseRampRateValue(rawValue);
        
        if (numericValue !== null) {
          const clampedValue = clamp(numericValue, 0.1, 20);
          const roundedValue = Math.round(clampedValue * 100) / 100;
          
          if (isP) {
            state.pRampRate = roundedValue;
            document.getElementById('pRampRate').value = roundedValue;
          } else {
            state.qRampRate = roundedValue;
            document.getElementById('qRampRate').value = roundedValue;
          }
          
          updateSliderValues();
          calculateRampProfile();
          updateChart();
        }
      } else {
        const rawValue = element.value;
        const numericValue = parseTimeValue(rawValue);
        
        if (numericValue !== null) {
          const clampedValue = clamp(numericValue, 5, 300);
          const roundedValue = Math.round(clampedValue);
          
          if (isP) {
            state.pRampTime = roundedValue;
            document.getElementById('pRampTime').value = roundedValue;
          } else {
            state.qRampTime = roundedValue;
            document.getElementById('qRampTime').value = roundedValue;
          }
          
          updateSliderValues();
          calculateRampProfile();
          updateChart();
        }
      }
    }

    // Update plant size from editable input
    function updatePlantSizeFromInput(element) {
      const rawValue = element.value;
      const numericValue = parsePlantSizeValue(rawValue);
      
      if (numericValue !== null) {
        const clampedValue = clamp(numericValue, 1, 1000);
        const roundedValue = Math.round(clampedValue);
        
        state.plantSize = roundedValue;
        document.getElementById('plantSize').value = roundedValue;
        
        updateSliderValues();
        calculateRampProfile();
        updateChart();
      }
    }

    // Update power factor from editable input
    function updatePowerFactorFromInput(element) {
      const rawValue = element.value;
      const numericValue = parsePowerFactorValue(rawValue);
      
      if (numericValue !== null) {
        const clampedValue = clamp(numericValue, 0.7, 1.0);
        const roundedValue = Math.round(clampedValue * 100) / 100;
        
        state.powerFactor = roundedValue;
        document.getElementById('powerFactor').value = roundedValue;
        
        updateSliderValues();
        calculateRampProfile();
        updateChart();
      }
    }

    // Calculate ramp profile
    function calculateRampProfile() {
      const reactivePower = calculateReactivePower(state.plantSize, state.powerFactor);
      const apparentPower = calculateApparentPower(state.plantSize, reactivePower);
      
      // Calculate ramp times and rates based on control mode
      let pRampTime, qRampTime;
      
      if (state.controlMode === 'rate') {
        // Calculate time from rate (time to go from 100% to 0% or vice versa)
        pRampTime = 100 / state.pRampRate; // seconds
        qRampTime = 100 / state.qRampRate; // seconds
      } else {
        // Use time directly and calculate rates
        pRampTime = state.pRampTime;
        qRampTime = state.qRampTime;
        state.pRampRate = 100 / pRampTime;
        state.qRampRate = 100 / qRampTime;
      }
      
      const totalRampTime = Math.max(pRampTime, qRampTime);

      // Update statistics
      document.getElementById('activePowerValue').textContent = formatNumber(state.plantSize);
      document.getElementById('reactivePowerValue').textContent = formatNumber(reactivePower);
      document.getElementById('apparentPowerValue').textContent = formatNumber(apparentPower);
      document.getElementById('pRampRateDisplay').textContent = formatNumber(state.pRampRate, 2);
      document.getElementById('qRampRateDisplay').textContent = formatNumber(state.qRampRate, 2);
      document.getElementById('pRampTimeDisplay').textContent = formatNumber(pRampTime);
      document.getElementById('qRampTimeDisplay').textContent = formatNumber(qRampTime);
      document.getElementById('totalTimeValue').textContent = formatNumber(totalRampTime);
      document.getElementById('pqRatioValue').textContent = formatNumber(state.pRampRate / state.qRampRate, 2);

      // Update status badges
      const statusContainer = document.getElementById('rampStatus');
      statusContainer.innerHTML = '';
      
      if (pRampTime > qRampTime + 5) {
        statusContainer.innerHTML = '<div class="warning-badge">⚠️ P ramp significantly slower than Q</div>';
      } else if (qRampTime > pRampTime + 5) {
        statusContainer.innerHTML = '<div class="warning-badge">⚠️ Q ramp significantly slower than P</div>';
      } else {
        statusContainer.innerHTML = '<div class="success-badge">✓ Well-balanced P and Q ramp rates</div>';
      }

      return {
        reactivePower,
        apparentPower,
        pRampTime,
        qRampTime,
        totalRampTime
      };
    }

    // Generate chart data
    function generateChartData() {
      const calc = calculateRampProfile();
      const timeStep = 0.5; // seconds
      const maxTime = Math.ceil(calc.totalRampTime / timeStep) * timeStep;
      
      const timePoints = [];
      const pPowerPoints = [];
      const qPowerPoints = [];
      const totalPowerPoints = [];

      for (let t = 0; t <= maxTime; t += timeStep) {
        timePoints.push(t);
        
        let pPercent, qPercent;
        
        if (state.direction === 'down') {
          // Ramp down from 100% to 0%
          pPercent = Math.max(0, 100 - (state.pRampRate * t));
          qPercent = Math.max(0, 100 - (state.qRampRate * t));
        } else {
          // Ramp up from 0% to 100%
          pPercent = Math.min(100, state.pRampRate * t);
          qPercent = Math.min(100, state.qRampRate * t);
        }
        
        const pPower = (pPercent / 100) * state.plantSize;
        const qPower = (qPercent / 100) * calc.reactivePower;
        const totalPower = calculateApparentPower(pPower, qPower);
        
        pPowerPoints.push(pPower);
        qPowerPoints.push(qPower);
        totalPowerPoints.push(totalPower);
      }

      return {
        timePoints,
        pPowerPoints,
        qPowerPoints,
        totalPowerPoints,
        maxTime
      };
    }

    // Update chart
    function updateChart() {
      const chartData = generateChartData();
      
      const data = {
        labels: chartData.timePoints,
        datasets: [
          {
            label: 'Active Power (P)',
            data: chartData.pPowerPoints,
            borderColor: '#772835',
            backgroundColor: 'rgba(119, 40, 53, 0.1)',
            fill: false,
            tension: 0.1,
            borderWidth: 3
          },
          {
            label: 'Reactive Power (Q)',
            data: chartData.qPowerPoints,
            borderColor: '#666666',
            backgroundColor: 'rgba(102, 102, 102, 0.1)',
            fill: false,
            tension: 0.1,
            borderWidth: 3
          },
          {
            label: 'Apparent Power (S)',
            data: chartData.totalPowerPoints,
            borderColor: '#999999',
            backgroundColor: 'rgba(153, 153, 153, 0.1)',
            fill: true,
            tension: 0.1,
            borderWidth: 2,
            borderDash: [5, 5]
          }
        ]
      };

      const options = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          title: {
            display: true,
            text: `Power Ramp Profile - ${state.direction === 'down' ? '100% → 0%' : '0% → 100%'}`,
            font: {
              size: 16,
              weight: 'bold'
            }
          },
          legend: {
            position: 'top',
            labels: {
              usePointStyle: true,
              padding: 20
            }
          }
        },
        scales: {
          x: {
            title: {
              display: true,
              text: 'Time (seconds)',
              font: {
                size: 14,
                weight: 'bold'
              }
            },
            grid: {
              alpha: 0.3
            }
          },
          y: {
            title: {
              display: true,
              text: 'Power (MW/Mvar/MVA)',
              font: {
                size: 14,
                weight: 'bold'
              }
            },
            beginAtZero: true,
            grid: {
              alpha: 0.3
            }
          }
        },
        elements: {
          point: {
            radius: 0,
            hoverRadius: 6
          }
        },
        interaction: {
          intersect: false,
          mode: 'index'
        }
      };

      if (rampChart) {
        rampChart.destroy();
      }

      const ctx = document.getElementById('rampChart').getContext('2d');
      rampChart = new Chart(ctx, {
        type: 'line',
        data: data,
        options: options
      });
    }

    // Event listeners for sliders
    function setupEventListeners() {
      // Plant Size - Slider
      document.getElementById('plantSize').addEventListener('input', (e) => {
        state.plantSize = parseFloat(e.target.value);
        updateSliderValues();
        calculateRampProfile();
        updateChart();
      });

      // Plant Size - Editable Value Display
      document.getElementById('plantSizeValue').addEventListener('blur', (e) => {
        updatePlantSizeFromInput(e.target);
      });

      document.getElementById('plantSizeValue').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          e.target.blur(); // Trigger blur event to update value
        }
      });

      // Power Factor - Slider
      document.getElementById('powerFactor').addEventListener('input', (e) => {
        state.powerFactor = parseFloat(e.target.value);
        updateSliderValues();
        calculateRampProfile();
        updateChart();
      });

      // Power Factor - Editable Value Display
      document.getElementById('powerFactorValue').addEventListener('blur', (e) => {
        updatePowerFactorFromInput(e.target);
      });

      document.getElementById('powerFactorValue').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          e.target.blur(); // Trigger blur event to update value
        }
      });

      // Control mode toggle
      document.querySelectorAll('input[name="controlMode"]').forEach(radio => {
        radio.addEventListener('change', (e) => {
          state.controlMode = e.target.value;
          
          // Show/hide appropriate controls
          if (state.controlMode === 'rate') {
            document.getElementById('rateControls').style.display = 'block';
            document.getElementById('timeControls').style.display = 'none';
          } else {
            document.getElementById('rateControls').style.display = 'none';
            document.getElementById('timeControls').style.display = 'block';
          }
          
          updateSliderValues();
          calculateRampProfile();
          updateChart();
        });
      });

      // Rate Mode Controls
      // P Ramp Rate - Slider
      document.getElementById('pRampRate').addEventListener('input', (e) => {
        state.pRampRate = Math.round(parseFloat(e.target.value) * 100) / 100;
        updateSliderValues();
        calculateRampProfile();
        updateChart();
      });

      // P Ramp Rate - Editable Value Display
      document.getElementById('pRampRateValue').addEventListener('blur', (e) => {
        updateFromValueInput(e.target, true);
      });

      document.getElementById('pRampRateValue').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          e.target.blur(); // Trigger blur event to update value
        }
      });

      // Q Ramp Rate - Slider
      document.getElementById('qRampRate').addEventListener('input', (e) => {
        state.qRampRate = Math.round(parseFloat(e.target.value) * 100) / 100;
        updateSliderValues();
        calculateRampProfile();
        updateChart();
      });

      // Q Ramp Rate - Editable Value Display
      document.getElementById('qRampRateValue').addEventListener('blur', (e) => {
        updateFromValueInput(e.target, false);
      });

      document.getElementById('qRampRateValue').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          e.target.blur(); // Trigger blur event to update value
        }
      });

      // Time Mode Controls
      // P Ramp Time - Slider
      document.getElementById('pRampTime').addEventListener('input', (e) => {
        state.pRampTime = parseInt(e.target.value);
        updateSliderValues();
        calculateRampProfile();
        updateChart();
      });

      // P Ramp Time - Editable Value Display
      document.getElementById('pRampTimeValue').addEventListener('blur', (e) => {
        updateFromValueInput(e.target, true);
      });

      document.getElementById('pRampTimeValue').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          e.target.blur(); // Trigger blur event to update value
        }
      });

      // Q Ramp Time - Slider
      document.getElementById('qRampTime').addEventListener('input', (e) => {
        state.qRampTime = parseInt(e.target.value);
        updateSliderValues();
        calculateRampProfile();
        updateChart();
      });

      // Q Ramp Time - Editable Value Display
      document.getElementById('qRampTimeValue').addEventListener('blur', (e) => {
        updateFromValueInput(e.target, false);
      });

      document.getElementById('qRampTimeValue').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          e.target.blur(); // Trigger blur event to update value
        }
      });

      document.querySelectorAll('input[name="direction"]').forEach(radio => {
        radio.addEventListener('change', (e) => {
          state.direction = e.target.value;
          updateChart();
        });
      });

      document.getElementById('updateBtn').addEventListener('click', () => {
        calculateRampProfile();
        updateChart();
      });

      document.getElementById('resetBtn').addEventListener('click', () => {
        // Reset to defaults
        state = {
          plantSize: 100,
          powerFactor: 0.95,
          pRampRate: 5.00,
          qRampRate: 3.00,
          pRampTime: 20,
          qRampTime: 33,
          direction: 'down',
          controlMode: 'rate'
        };
        
        // Update sliders
        document.getElementById('plantSize').value = state.plantSize;
        document.getElementById('powerFactor').value = state.powerFactor;
        document.getElementById('pRampRate').value = state.pRampRate;
        document.getElementById('qRampRate').value = state.qRampRate;
        document.getElementById('pRampTime').value = state.pRampTime;
        document.getElementById('qRampTime').value = state.qRampTime;
        document.querySelector('input[name="direction"][value="down"]').checked = true;
        document.querySelector('input[name="controlMode"][value="rate"]').checked = true;
        
        // Reset visibility
        document.getElementById('rateControls').style.display = 'block';
        document.getElementById('timeControls').style.display = 'none';
        
        updateSliderValues();
        calculateRampProfile();
        updateChart();
      });
    }

    // Initialize the application
    function init() {
      updateSliderValues();
      calculateRampProfile();
      updateChart();
      setupEventListeners();
    }

    // Start the app when DOM is ready
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
