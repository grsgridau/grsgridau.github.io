<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Power Plant Ramp Rate</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 20px auto; padding: 0 10px; }
    .control-group { margin-bottom: 20px; }
    label { display: block; margin-bottom: 5px; font-weight: bold; }
    input[type=range] { width: 100%; }
    .value { font-weight: bold; }
    #chartContainer { width: 100%; height: 400px; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h1>Power Plant Ramp Rate</h1>

  <div class="control-group">
    <label for="mwSlider">Plant Size (MW): <span id="mwValue" class="value">50</span></label>
    <input type="range" id="mwSlider" min="1" max="500" step="1" value="50">
  </div>

  <div class="control-group">
    <label for="pfInput">Power Factor: <span id="pfValue" class="value">0.98</span></label>
    <input type="number" id="pfInput" min="0.8" max="1" step="0.01" value="0.98">
  </div>

  <div class="control-group">
    <label for="rampPSlider">Ramp Rate P (%/sec): <span id="rampPValue" class="value">10</span></label>
    <input type="range" id="rampPSlider" min="0.1" max="50" step="0.1" value="10">
  </div>

  <div class="control-group">
    <label for="rampQSlider">Ramp Rate Q (%/sec): <span id="rampQValue" class="value">10</span></label>
    <input type="range" id="rampQSlider" min="0.1" max="50" step="0.1" value="10">
  </div>

  <div id="chartContainer">
    <canvas id="rampChart"></canvas>
  </div>

  <script>
    const mwSlider = document.getElementById('mwSlider');
    const pfInput = document.getElementById('pfInput');
    const rampPSlider = document.getElementById('rampPSlider');
    const rampQSlider = document.getElementById('rampQSlider');

    const mwValue = document.getElementById('mwValue');
    const pfValue = document.getElementById('pfValue');
    const rampPValue = document.getElementById('rampPValue');
    const rampQValue = document.getElementById('rampQValue');

    function pfToQ(p, pf) {
      const theta = Math.acos(pf);
      return p * Math.tan(theta);
    }

    function generateRampData(Pmax, Qmax, rampP, rampQ) {
      const timeP = 100 / rampP;
      const timeQ = 100 / rampQ;
      const totalT = Math.max(timeP, timeQ);
      const steps = Math.ceil(totalT * 4);
      const labels = [];
      const dataP = [];
      const dataQ = [];

      for (let i = 0; i <= steps; i++) {
        const t = (i * totalT) / steps;
        const percentP = Math.max(100 - rampP * t, 0);
        const percentQ = Math.max(100 - rampQ * t, 0);
        labels.push(t.toFixed(2));
        dataP.push((Pmax * percentP / 100).toFixed(2));
        dataQ.push((Qmax * percentQ / 100).toFixed(2));
      }

      return { labels, dataP, dataQ };
    }

    const ctx = document.getElementById('rampChart').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [
          {
            label: 'Active Power (MW)',
            data: [],
            borderWidth: 2,
            fill: false
          },
          {
            label: 'Reactive Power (MVAr)',
            data: [],
            borderWidth: 2,
            fill: false
          }
        ]
      },
      options: {
        responsive: true,
        scales: {
          x: { title: { display: true, text: 'Time (s)' } },
          y: { title: { display: true, text: 'Output (MW/MVAr)' } }
        }
      }
    });

    function updateChart() {
      const Pmax = parseFloat(mwSlider.value);
      const pf = parseFloat(pfInput.value);
      const Qmax = pfToQ(Pmax, pf);
      const rampP = parseFloat(rampPSlider.value);
      const rampQ = parseFloat(rampQSlider.value);

      mwValue.textContent = Pmax;
      pfValue.textContent = pf.toFixed(2);
      rampPValue.textContent = rampP;
      rampQValue.textContent = rampQ;

      const { labels, dataP, dataQ } = generateRampData(Pmax, Qmax, rampP, rampQ);
      chart.data.labels = labels;
      chart.data.datasets[0].data = dataP;
      chart.data.datasets[1].data = dataQ;
      chart.update();
    }

    [mwSlider, pfInput, rampPSlider, rampQSlider].forEach(el => {
      el.addEventListener('input', updateChart);
    });

    updateChart();
  </script>
</body>
</html>
